
[settings]
  strict = true
  verbose = true
  debug = true

  build_dir = "build"
  site_dir = "site"

  default_template_file = "templates/main.html"
  default_content_selector = "main"

  doctype = "<!DOCTYPE html>"

  clean_urls = true

  page_file_extensions = ["htm", "html", "md"]

  ignore_extensions = ["draft"]

  plugin_discovery = true
  plugin_dirs = ["plugins"]

[preprocessors]
  md = 'pandoc -f commonmark+smart -t html --no-highlight --lua-filter=scripts/cmark-code-blocks.lua'

[custom_options]
  site_url = "https://soupault.app"

  latest_soupault_version = "2.5.0"

[index]
  index = true

  sort_descending = true
  sort_by = "date"

  extract_after_widgets = ["insert-reading-time"]
  strip_tags = false
  dump_json = "index.json"

  section = "blog"

  date_formats = ["%F"]

# Metadata extracted from pages, using CSS selectors to find
# elements to extract data from
[index.fields]
  title = {
    selector = ["h1#post-title", "h1"]
  }

  date = {
    selector = ["time#post-date", "time"],
    extract_attribute = "datetime",
    fallback_to_content = true
  }

  excerpt = {
    selector = ["p#post-excerpt", "p"]
  }

  reading_time = {
    selector = "span#reading-time"
  }

[index.views.blog]
  index_selector = "#blog-index"
  index_item_template = """
    <h2><a href="{{url}}">{{title}}</a></h2>
    <p><strong>Last update:</strong> {{date}}.</p>
    <p><strong>Reading time:</strong> {{reading_time}}.</p>
    <p>{{excerpt}}</p>
    <a href="{{url}}">Read more</a>
  """

[widgets.page-title]
  widget = "title"
  selector = ["h1", "#title", "#post-title"]
  default = "soupault"
  append = " &mdash; soupault"

[widgets.footnotes]
  widget = "footnotes"
  selector = "div#footnotes"
  footnote_selector = ["fn", ".footnote"]
  footnote_link_class = "footnote"
  back_links = true
  link_id_prepend = "footnote-"
  back_link_id_append = "-ref"

[widgets.table-of-contents]
  exclude_page = ["reference-manual-v1.html", "reference-manual.md"]
  after = "insert-reading-time"

  widget = "toc"
  selector = "#generated-toc"

  min_level = 2

  toc_list_class = "toc"
  toc_class_levels = false

  numbered_list = false

  heading_links = true
  heading_link_text = "→ "
  heading_link_class = "here"

  use_heading_slug = true

[widgets.nav-menu]
  widget = "include"
  file = "templates/menu.html"
  selector = ["nav"]

[widgets.highlight-active-link]
  after = ["nav-menu", "footer"]
  widget = "section-link-highlight"
  selector = "nav"
  active_link_class = "nav-active"

[widgets.footer]
  widget = "include"
  file = "templates/footer.html"
  selector = "footer"

[widgets.remove-footnotes-from-excerpts]
  widget = "delete_element"
  selector = "a.footnote"

  page = "blog/index.html"
  after = "footnotes"

[widgets.insert-reading-time-container]
  section = "blog"
  widget = "insert_html"
  action = "insert_after"
  selector = "h1#post-title"
  html = '<div>Estimated reading time: <span id="reading-time"></span>.</div>'

[widgets.insert-reading-time]
  after = "insert-reading-time-container"
  widget = "reading-time"
  selector = "#reading-time"
  content_selector = "main"

[widgets.escape-html-in-pre]
  widget = "escape-html"
  selector = ".raw-html"

# Runs the content of <* class="language-*"> elements through a syntax highlighter
[widgets.highlight]
  after = "escape-html-in-pre"
  widget = "preprocess_element"
  selector = '*[class^="language-"]'
  command = 'highlight -O html -f --syntax=$(echo $ATTR_CLASS | sed -e "s/language-//")'

[widgets.quick-links]
  widget = "quick-links"

# Processes <soupault-release> elements and converts them into file/signature links
[widgets.create-download-links]
  widget = "soupault-release"

[widgets.refman-table-of-contents]
  page = ["reference-manual-v1.html", "reference-manual.md"]
  after = "insert-reading-time"

  widget = "toc"
  selector = "#generated-toc"

  valid_html = true

  toc_class_levels = true

  min_level = 2
  max_level = 4
  max_heading_link_level = 6

  toc_list_class = "refman-toc"
  
  numbered_list = false

  heading_links = true
  heading_link_text = "→ "
  heading_link_class = "here"

  use_heading_slug = true

[widgets.refman-glossary]
  page = "reference-manual.md"
  widget = "glossary"

[widgets.refman-api-lists]
  page = "reference-manual.md"
  widget = "module-api"  

[widgets.convertor-scripts]
  page = "1-to-2.html"
  widget = "insert_html"
  html = '<script src="/scripts/toml.js"></script> <script src="/scripts/1-to-2.js"></script>'
  selector = "head"
  action = "append_child"

[widgets.goat-counter]
  widget = "insert_html"
  parse = true
  html = '<script data-goatcounter="https://soupault.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>'
  selector = "body"
  action = "append_child"

[widgets.atom]
  widget = "atom"
  page = "blog/index.html"
  use_section = "blog"

  delete_elements = [".footnote", "a"]
  
  feed_file = "atom.xml"
  feed_author = "Daniil Baturin and soupault contributors"
  feed_author_email = "daniil+soupault@baturin.org"
  feed_title = "soupault"
  feed_subtitle = "A static website generator and programmable HTML processor"
  feed_logo = "https://soupault.neocities.org/images/soupault_stick_horse.png"
